---
title: "Simulation - example usage"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Example_simulation}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.width = 5,
  fig.align = 'center'
)
```


\maketitle

\section{Sequence data simulation}

We generate $n$ sequences $s_1, \ldots, s_n$ of length $N$ based on real frequences of amino acids on full alphabet.

| exttt{A}   | \texttt{L} | \texttt{A} | \texttt{V} | \texttt{P} | \texttt{H} | \texttt{G} | \texttt{K} | \texttt{T} | \texttt{F} |
|------------|------------|------------|------------|------------|------------|------------|------------|------------|------------|
| \texttt{S} | \texttt{L} | \texttt{Q} | \texttt{W} | \texttt{E} | \texttt{P} | \texttt{V} | \texttt{L} | \texttt{D} | \texttt{T} |
| \texttt{R} | \texttt{I} | \texttt{F} | \texttt{N} | \texttt{N} | \texttt{V} | \texttt{Q} | \texttt{G} | \texttt{A} | \texttt{A} |
| \texttt{G} | \texttt{C} | \texttt{S} | \texttt{D} | \texttt{G} | \texttt{Y} | \texttt{D} | \texttt{Q} | \texttt{T} | \texttt{R} |
| \texttt{Y} | \texttt{L} | \texttt{R} | \texttt{R} | \texttt{S} | \texttt{R} | \texttt{P} | \texttt{D} | \texttt{A} | \texttt{V} |
| \texttt{N} | \texttt{V} | \texttt{S} | \texttt{M} | \texttt{M} | \texttt{T} | \texttt{R} | \texttt{G} | \texttt{D} | \texttt{I} |


\section{Motif generation}

We generate a set of $m$ motifs ($m_1, \ldots, m_m$) with the following parameters:

\begin{itemize}
    \item $n_m$: denoting maximum number of letters in motif
    \item $d_m$: denoting maximum number of gaps in motif
\end{itemize}

\begin{table}[!h]
    \centering
    \begin{tabular}{ccccccccc}
\texttt{A} & \texttt{\_} & \texttt{\_} & \texttt{B} &  &  &  &     \\
\texttt{Y} & \texttt{L} & \texttt{\_} & \texttt{G} & \texttt{\_} & \texttt{\_} & \texttt{D}  \\
\texttt{N} & \texttt{\_} & \texttt{\_} & \texttt{\_} & \texttt{\_} & \texttt{M} &   \\
\texttt{A} & \texttt{B} & \texttt{\_} & \texttt{T} &  &  &   \\

    \end{tabular}
    \caption{Example motifs}
    \label{tab:motifs}
\end{table}

\section{Motif injection}

We inject motif by replacing a randomly selected part of a sequence with this motif. For example:

\begin{table}[!h]
    \centering
    \begin{tabular}{cccccccccc}
\texttt{A} & \texttt{L} & \texttt{A} & \texttt{V} & \texttt{P} & \texttt{H} & \texttt{G} & \texttt{K} & \texttt{T} & \texttt{F} \\
\texttt{S} & \texttt{L} & \texttt{Q} & \texttt{W} & \texttt{E} & \texttt{P} & \texttt{V} & \texttt{L} & \texttt{D} & \texttt{T} \\
\texttt{R} & \texttt{I} & \texttt{F} & \texttt{N} & \texttt{N} & \texttt{V} & \texttt{Q} & \texttt{G} & \texttt{A} & \texttt{A} \\
\rowcolor{green!25}
\texttt{G} & \textbf{\texttt{A}} & \textbf{\texttt{B}} & \texttt{D} & \textbf{\texttt{T}} & \texttt{Y} & \texttt{D} & \texttt{Q} & \texttt{T} & \texttt{R} \\
\rowcolor{green!25}
\texttt{Y} & \texttt{L} & \texttt{R} & \texttt{R} & \texttt{S} & \texttt{R} & \textbf{\texttt{A}} & \textbf{\texttt{B}} & \texttt{A} & \textbf{\texttt{T}} \\
\rowcolor{green!25}
\texttt{N} & \texttt{V} & \textbf{\texttt{A}} & \textbf{\texttt{B}} & \texttt{M} & \textbf{\texttt{T}} & \texttt{R} & \texttt{G} & \texttt{D} & \texttt{I} \\

    \end{tabular}
    \caption{Example sequences of length 10 with addition of motif \texttt{AB\_T}}
    \label{tab:my_label}
\end{table}

\noindent  We inject from $0$ to $k$ motifs to a single sequence according to the following procedure:

\begin{enumerate}
    \item Set the ratio $r_m$ of sequences with at least one motif.
    \item For each sequence $s_i$ sample a number of motifs to inject as follows:
$$k_i \in \left\{\begin{array}{cl}
\lbrace 1, 2, \ldots, k\rbrace, & 1 < i \leq \lfloor n \cdot r_m\rfloor  \\
\lbrace 0\rbrace, & \lfloor n \cdot r_m\rfloor  < i \leq n
\end{array} \right.$$
    \item For $s_i$ sample $k_i$ motifs from set $\lbrace m_1, \ldots, m_m\rbrace$

\end{enumerate}

\begin{figure}[h]
    \centering
    \includegraphics[width=1\linewidth]{figs/kmers.drawio.pdf}
    \label{fig:scheme1}
    \caption{Scheme of sequence data simulation.}
\end{figure}



\section{Target variable sampling}

\noindent Let's define a random variable $X_K$ on a set of sequences $s_1, \ldots, s_n$ which describes whether a sequence $K$ is a subsequence of $s_i$. Namely, for any sequence $s_i$:

$$X_K(s_i) = \left\{\begin{array}{rl}
1, & K \subseteq s_i\\
0, & \text{otherwise}
\end{array} \right.$$

\noindent where $K \subseteq s_2$ means that $K$ is a subsequence of $s_2$. For example

$$X_{\texttt{AB}}(\texttt{ABCD}) = 1,$$
$$X_{\texttt{A\_B}}(\texttt{ABCD}) = 0.$$

\begin{figure}[h!]
    \centering
    \includegraphics[width=0.9\linewidth]{figs/models.pdf}
    \label{fig:scheme1}
    \caption{Probability of success for the fearure sampling.}
\end{figure}


\subsection{Logistic regression}

In this case we consider a standard logistic regression model where the joint effect of all motifs is the sum of their individual effects. Let $w_1, \ldots, w_m$ be weights related to motifs $m_1, \ldots, m_m$. Let $w_0$ be an effect for the sequences without motifs. Then, we can define an additive logistic model as follows:

$$g(EY) = w_0 + w_1 X_{m_1} + w_2 X_{m_2} + \ldots + w_m X_{m_m}$$
We assume some particular values of $w_1, \ldots, w_m$ and calculate vector of probabilities $p$ as follows:

$$p = g^{-1}(w_0 + w_1 X_{m_1} + w_2 X_{m_2} + \ldots + w_m X_{m_m}).$$
Having $p$ we simulate $y_i$ from binomial distribution $B(1, p_i)$.

\subsection{Logistic regression with interactions}

Another approach is based on interactions indicating that the effect of one predictor depends on the value of another predictor. Let's define maximum number of motifs per sequence $k = \max\lbrace k_i, i = 1, \ldots, n\rbrace$. Let $w_{1}, \ldots, w_{k}$ denote weights of single effects. Namely:

$$g(EY) = w_0 + \sum_{i = 1}^{k} w_{i} X_{m_i} + \left(\sum_{i = 1}^{k-1}\sum_{j = i + 1}^{k} w_{ij} X_{m_i}X_{m_j}\right) + \ldots + w_{1\ldots k} X_{m_1}\ldots X_{m_k}$$

\subsection{Logic regression}

Here, we consider new variables, $L_1, \ldots, L_l$ where each of them is a logic expression based on a subset of motifs $m_1, \ldots, m_m$. For example, $$L_1(m_1, m_2, m_3) = (X_{m_1} \land X_{m_2}) \lor X_{m_3}.$$ Each variable $L_i$ obtains its own weight in the model. Our model is following:

 $$g(EY) = w_0 + \sum_{i = 1}^{l} w_i L_i.$$

